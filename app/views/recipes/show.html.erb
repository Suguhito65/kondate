<main class="recipe-show">
  <div class="recipe-box">
    <div class="arrow">
      <% if @recipe.previous.present? %>
        <%= link_to "＜ 前へ", recipe_path(@recipe.previous), class: "btn_arrow" %>
      <% end %>
      <% if @recipe.next.present? %>
        <%= link_to "次へ ＞", recipe_path(@recipe.next), class: "btn_arrow" %>
      <% end %>
    </div>
    <p class="cuisine">
      <%= @recipe.cuisine %>
    </p>

    <% if user_signed_in? && current_user.id == @recipe.user_id %>
      <div class="btn_manage">
        <%= link_to 'レシピの編集', edit_recipe_path(@recipe.id), class: "edit-btn" %>
        <%= link_to 'レシピの削除', recipe_path(@recipe.id), method: :delete, class:'recipe-destroy' %>
      </div>
    <% end %>

    <div class='recipe-img-content'>
      <%= image_tag @recipe.image, class: "recipe-box-img" %>
    </div>

    <% if user_signed_in? %>
      <div class="favorite">
        <% if current_user.already_favorited?(@recipe) %>
          <%= link_to recipe_favorite_path(@recipe, @recipe.id), method: :delete do %>
            <%= image_tag "iine2.png" ,class:"favorite-star-icon" ,width:"20",height:"20"%>
          <% end %>
        <% else %>
          <%= link_to recipe_favorites_path(@recipe, @recipe.id), method: :post do %>
            <%= image_tag "iine.png" ,class:"favorite-star-icon" ,width:"20",height:"20"%>
          <% end %>
        <% end %>
        <%= @recipe.favorites.count %>
      </div>
    <% end %>

    <table class="detail-table">
      <tr>
        <th class="detail-recipe">レシピ説明</th>
        <td class="detail-value">
          <%= @recipe.description %>
        </td>
      </tr>
      <tr>
        <th class="detail-recipe">食材</th>
        <td class="detail-value">
          <%= @recipe.foodstuff %>
        </td>
      </tr>
      <tr>
        <th class="detail-recipe">料理人</th>
        <td class="detail-value">
          <%= link_to @recipe.user.name, user_path(@recipe.user_id), class: :recipe__user %>
        </td>
      </tr>
    </table>
    <div class="container">
      <div class="recipe__comments">
      <% if current_user %>
        <%= form_with(model: [@recipe , @comment], local: true) do |f| %>
          <div class="field">
            <%= f.label :text, "コメント", class: :detail__title %><br>
            <%= f.text_field :text, placeholder:"不適切な文言は控えて下さい", class: "input-default" %>
            <%= f.submit "送信", class: :comment__btn  %>
          </div>
        <% end %>
      <% end %>
      <div class="comments">
        <p class="detail__title">コメント一覧</p>
        <ul class="comment__container">
          <% if @comments %>
            <% @comments.each do |comment| %>
              <li class="comment__list">
                <%= comment.text %>
                <% if user_signed_in? && current_user.id == comment.user_id %>
                  <%= link_to '削除', "/recipes/#{@recipe.id}/comments/#{comment.id}", method: :delete, class: :comment__destroy %>
                <% end %>
                <%= link_to "by#{comment.user.name}", user_path(comment.user_id), class: :comment__user %>
              </li>
            <% end %>
          <% end %>
        </ul>
      </div>
    </div>
  </div>
</main>